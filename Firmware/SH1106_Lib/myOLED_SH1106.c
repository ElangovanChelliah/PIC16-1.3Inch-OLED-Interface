
#include "myOLED_SH1106.h"
#include "../mcc_generated_files/mcc.h"

/*
 //* TEST CHARACTER (5820000 B CHINESE CHARACTER)
static unsigned char Frame[] = {
        0x84,0x10,0x84,0x30,0xFC,0x1F,0x84,0x08,0x84,0x08,0x40,0x00,0x5E,0xFE,0x50,0x02,
        0x50,0x02,0x50,0x7F,0xDF,0x02,0x50,0x7E,0x50,0x02,0x50,0x82,0x5E,0xFE,0x00,0x00,
        0x00,0x40,0x00,0x30,0xFC,0x0F,0x44,0x40,0x54,0x23,0x54,0x15,0x54,0x49,0x55,0x81,
        0xFE,0x7F,0x54,0x05,0x54,0x09,0x54,0x11,0xF4,0x29,0x44,0x44,0x44,0x40,0x00,0x00,
        0x24,0x08,0x24,0x06,0xA4,0x01,0xFE,0xFF,0xA3,0x00,0x22,0x01,0x00,0x04,0x22,0x04,
        0xCC,0x04,0x00,0x04,0x00,0x04,0xFF,0xFF,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x00,
        0x10,0x04,0x10,0x44,0x10,0x82,0xFF,0x7F,0x10,0x01,0x90,0x80,0x08,0x80,0x88,0x40,
        0x88,0x43,0x88,0x2C,0xFF,0x10,0x88,0x28,0x88,0x46,0x88,0x81,0x08,0x80,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0xF8,0x19,0x08,0x21,0x88,0x20,0x88,0x20,0x08,0x11,0x08,0x0E,0x00,0x00,
        0x00,0x00,0x70,0x1C,0x88,0x22,0x08,0x21,0x08,0x21,0x88,0x22,0x70,0x1c,0x00,0x00,
        0x00,0x00,0x70,0x30,0x08,0x28,0x08,0x24,0x08,0x22,0x88,0x21,0x70,0x30,0x00,0x00,
        0x00,0x00,0xE0,0x0F,0x10,0x10,0x08,0x20,0x08,0x20,0x10,0x10,0xE0,0x0F,0x00,0x00,
        0x00,0x00,0xE0,0x0F,0x10,0x10,0x08,0x20,0x08,0x20,0x10,0x10,0xE0,0x0F,0x00,0x00,
        0x00,0x00,0xE0,0x0F,0x10,0x10,0x08,0x20,0x08,0x20,0x10,0x10,0xE0,0x0F,0x00,0x00,
        0x00,0x00,0xE0,0x0F,0x10,0x10,0x08,0x20,0x08,0x20,0x10,0x10,0xE0,0x0F,0x00,0x00
    };


 */


//TEST CHARACTER (INNORADIA)

static unsigned char Frame[] = {
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,							
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	    
        0xFF,0x7F,0xFF,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x7F,0xFF,0x7F,							
        0x0E,0x00,0x18,0x00,0x30,0x00,0x60,0x00,0xC0,0x00,0x80,0x01,0x00,0x07,0xFF,0x7F,							
        0xFF,0x7F,0x0C,0x00,0x18,0x00,0x30,0x00,0x60,0x00,0xC0,0x00,0x80,0x01,0x00,0x03,							
        0x00,0x06,0x00,0x0C,0x00,0x18,0xFF,0x7F,0xFF,0x7F,0x00,0x00,0xE0,0x03,0xF8,0x0F,							
        0x0C,0x18,0x06,0x30,0x03,0x60,0x01,0x40,0x01,0x40,0x01,0x40,0x01,0x40,0x01,0x40,							
        0x01,0x40,0x03,0x60,0x06,0x30,0x0C,0x18,0xF8,0x07,0xE0,0x03,0x00,0x00,0x00,0x00,							
        0xFF,0x7F,0xFF,0x7F,0xFF,0x7F,0x07,0x00,0x87,0x01,0x87,0x07,0x87,0x0F,0xFF,0x1F,	
        0xFF,0x79,0xFE,0x70,0x00,0x60,0x00,0x00,0x00,0x70,0x00,0x7E,0xE0,0x7F,0xFC,0x0F,							
        0xFF,0x01,0x3F,0x00,0x3F,0x00,0xFC,0x01,0xF0,0x0F,0xC0,0x7F,0x00,0x7E,0x00,0x70,							
        0x00,0x00,0x00,0x00,0xFF,0x7F,0xFF,0x7F,0xFF,0x7F,0x07,0x70,0x07,0x70,0x07,0x70,							
        0x07,0x70,0xFE,0x7F,0xFE,0x3F,0xF8,0x0F,0x00,0x00,0x00,0x00,0xFF,0x7F,0xFF,0x7F,							
        0xFF,0x7F,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x7E,0xF0,0x7F,0xFC,0x0F,0xFF,0x01,							
        0x3F,0x00,0x3F,0x00,0xFC,0x01,0xF0,0x0F,0xC0,0x7F,0x00,0x7E,0x00,0x70,0x00,0x40,
    };


void I2C_Start(void){
    SCL = 0;
	__delay_us(1);
	SDA = 1;
	SCL = 1;
	__delay_us(1);
	SDA = 0;
	SCL = 0;
}

void I2C_Stop(void){
    SCL = 0;
	SDA = 0;
	SCL = 1;
	__delay_us(1);
	SDA = 1;
}

bool SH1106_Write_1byte(uint8_t D){
    uint8_t i;
    bool SH1106_Ack = 0;
    uint8_t Data = D;
    for(i=0;i<8;i++){
        SDA = (bool)(Data&0x80);
        NOP();
        SCL = 1;
        NOP();NOP();
        SCL = 0;
        Data = Data<<1;
    }
    SDA = 1;
    NOP();NOP();
    SCL = 1;
    NOP();NOP();
    SH1106_Ack = SDA_Ack;
    SCL = 0;
    return SH1106_Ack;
}

void SH1106_Write_Command(uint8_t Command){
    I2C_Start();
    SH1106_Write_1byte(SH1106_ADD_Write);
    SH1106_Write_1byte(SH1106_Command);
    SH1106_Write_1byte(Command);
    I2C_Stop();
}

void SH1106_Write_Data(uint8_t Data){
    I2C_Start();
    SH1106_Write_1byte(SH1106_ADD_Write);
    SH1106_Write_1byte(SH1106_Data);
    SH1106_Write_1byte(Data);
    I2C_Stop();
}

void SH1106_Clear_Screen(uint8_t disp_data){
    uint8_t page_index = 0, colume_index = 0;
    for(page_index=0;page_index<8;page_index++){
        SH1106_Write_Command(0xB0 + page_index);
        SH1106_Write_Command(0x10);
        SH1106_Write_Command(0x02);
        for(colume_index=0;colume_index<128;colume_index++){
            SH1106_Write_Data(disp_data);
        }
    }
}

void SH1106_init(void){
    I2C_Stop();
    SH1106_Write_Command(0xAE);
    SH1106_Write_Command(0xD5);
    SH1106_Write_Command(0x80);
    SH1106_Write_Command(0xAD);
    SH1106_Write_Command(0x8B);
    SH1106_Write_Command(0x32);
    SH1106_Write_Command(0x81);
    SH1106_Write_Command(0x80);
    SH1106_Write_Command(0xDA);
    SH1106_Write_Command(0x12);
    SH1106_Write_Command(0xD3);
    SH1106_Write_Command(0x00);
    SH1106_Write_Command(0xA1);
    SH1106_Write_Command(0xC8);
    SH1106_Write_Command(0xA6);
    SH1106_Write_Command(0xAF);
}

void SH1106_Set_Pos(uint8_t x, uint8_t y){
    SH1106_Write_Command(0xB0 + y);
    //設置列位址高4位
    //10H-17H    0 0 0 1 A7 A6 A5 A4
    SH1106_Write_Command((((x+2)&0xF0)>>4) | 0x10);
    //設置列位址低4位
    //00H-0FH    0 0 0 0 A3 A2 A1 A0
    SH1106_Write_Command((x+2)&0x0F);
}

void SH1106_Display(void){
    uint8_t page_index = 0, colume_index = 0;
    for(page_index=3;page_index<5;page_index++){
        SH1106_Write_Command(0xB0 + page_index);
        SH1106_Write_Command(0x10);
        SH1106_Write_Command(0x02);
        for(colume_index=0;colume_index<128;colume_index++){
            if(page_index == 3)
                SH1106_Write_Data(Frame[colume_index*2]);
            else
                SH1106_Write_Data(Frame[colume_index*2+1]);
        }
    }
}